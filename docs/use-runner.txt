
files = {
  "cyber-dojo.sh" => 'ruby ./cyber-dojo-traffic-light.rb',
  "traffic-light.rb" => get_rag_lambda_src(image_name, id),
  "stdout" => stdout,
  "stderr" => stderr,
  "status" => status,
  "cyber-dojo-traffic-light.rb" =>
    <<~RUBY
    rag = eval(IO.read('traffic-light.rb'))
    stdout = IO.read('stdout')
    stderr = IO.read('stderr')
    status = IO.read('status')
    print rag.call(stdout, stderr, status)
    RUBY
}
max_seconds = 5
result = runner.run_cyber_dojo_sh('cyberdojofoundation/ruby', id, files, max_seconds)
rgb = result['stdout']['content'].strip
rgb =~ /^red|amber|green$/ ? rgb : 'amber'  # drop later


def get_rag_lambda_src(image_name, id)
  files = { 'cyber-dojo.sh' => 'cat /usr/local/bin/red_amber_green.rb' }
  max_seconds = 5
  result = runner.run_cyber_dojo_sh(image_name, id, files, max_seconds)
  result['stdout']['content']
end
