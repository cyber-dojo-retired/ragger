
Thinking about image-names and immutability.
Suppose an image-name was tagged with its sha
and the manifest.json named that sha tag. Viz
{
  "image_name": "cyberdojofoundation/java_junit",
  ...
}
became, eg
{
  "image_name": "cyberdojofoundation/java_junit:2a7212b",
  ...
}

What are the implications of this approach?

Existing sessions would obviously carry on with their original image.

Suppose you wanted to create a new start-point, eg Java-JUnit5.
You would bake a new image with new jars. Then you would create
a new start-point with a new tagged image-name as above and a new set
of files, eg HikerTest.java cyber-dojo.sh
Then you would commit that.
Then you would force a ci-run of the languages repo.

How to set the image tag and get it into the manifest?
One way is to rename the manifest.json file as eg
manifest.json.base
and embed vars inside this .base file, eg
{
  "image_name": "cyberdojofoundation/java_junit:${IMAGE_TAG}",
  ...
}
Then as part of the ci-run do a simple substitution of ${IMAGE_TAG}
to create the actual manifest.json file.
But this won't work. The problem is the git commit happens
before the substitution takes place...
Seems pretty clear I have to separate the creation of the tagged image
from the creation of the start-point. They need to be two commits.
Are they on two repos or on one repo?

Also, what is the implication for puller?
Seems like immutable tagged images means I don't need a puller.
But puller was also about security updates...
What do you do for immutable tagged-images if there is a security issue
on an old existing session? That was where :latest was useful.
It is looking more and more like I need to put version numbers into the
display-names and image-names. Eg
{
  "display_name": "Java 1.8, JUnit 5",
  "image_name": "cyberdojofoundation/java1.8_junit5", // always :latest
  ...
}
And puller does its 24 hour update for security issues.
Do you keep one java-junit repo?
That doesn't fit with the repo-name <-> image-name correspondence.
If one repo, how do you know which commit is for a specific name?
You need to embed the SHA inside the image.
If separate repos, then the Dockerfile needs its commands to be
more carefully written to install specific versions.
Also, ragger cannot just get the image-names from languages/custom
and pull them. Because now, there could be sessions with image-names
that are no longer in any of the languages/custom start-points.
Could just ignore that?
Could make that a signal that old sessions are no longer runnable.


What is the implication for ragger?
